<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload with Transformations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.2/mdb.min.css">
    <style>
        body {
            background-color: #f4f4f4;
            font-family: Arial, sans-serif;
        }
        .upload-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        .history-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            height: 80vh;
            overflow-y: auto;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .transform-options {
            margin-bottom: 20px;
        }
        .transform-options label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .transform-options input,
        .transform-options select {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <!-- Upload Section -->
            <div class="col-md-8">
                <div class="upload-container">
                    <h3>Upload Image</h3>
                    <div class="transform-options">
                        <!-- Width and Height -->
                        <div class="row">
                            <div class="col-md-6">
                                <label for="width">Width (10-3840px)</label>
                                <input type="number" id="width" class="form-control" min="10" max="3840" placeholder="Width">
                            </div>
                            <div class="col-md-6">
                                <label for="height">Height (10-3840px)</label>
                                <input type="number" id="height" class="form-control" min="10" max="3840" placeholder="Height">
                            </div>
                        </div>

                        <!-- Quality -->
                        <label for="quality">Quality (1-100)</label>
                        <input type="number" id="quality" class="form-control" min="1" max="100" value="85" placeholder="Quality">

                        <!-- Format -->
                        <label for="format">Format</label>
                        <select id="format" class="form-select">
                            <option value="jpg">JPEG</option>
                            <option value="png">PNG</option>
                            <option value="webp">WEBP</option>
                        </select>

                        <!-- Resize Mode -->
                        <label for="resizeMode">Resize Mode</label>
                        <select id="resizeMode" class="form-select">
                            <option value="fill">Fill</option>
                            <option value="fit">Fit</option>
                            <option value="crop">Crop</option>
                            <option value="thumb">Thumbnail</option>
                        </select>

                        <!-- Background Color -->
                        <label for="background">Background Color (Hex)</label>
                        <input type="color" id="background" class="form-control" value="#ffffff">

                        <!-- Maintain EXIF -->
                        <label for="maintainExif">Maintain EXIF Metadata</label>
                        <select id="maintainExif" class="form-select">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>

                    <!-- File Input and Upload Button -->
                    <input type="file" class="form-control" id="fileInput" accept="image/*">
                    <button class="btn btn-primary mt-3" onclick="validateUpload()">Upload</button>
                </div>
            </div>

            <!-- Show History Section -->
            <div class="col-md-4">
                <div class="history-section">
                    <h4>Upload History</h4>
                    <div id="uploadHistory"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="uploadToast" role="alert" aria-live="assertive" aria-atomic="true" data-mdb-autohide="true" data-mdb-delay="3000" style="position: fixed; bottom: 20px; right: 20px;">
        <div class="toast-header">
            <i class="fas fa-check-circle me-2 text-success"></i>
            <strong class="me-auto">Success</strong>
            <small>Just now</small>
            <button type="button" class="btn-close" data-mdb-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            Image uploaded successfully!
        </div>
    </div>

    <!-- Cloudinary SDK -->
    <script src="https://unpkg.com/cloudinary-core@2.11.4/cloudinary-core-shrinkwrap.min.js"></script>

    <script>
        // Cloudinary configuration
        const cloudinary = cloudinary.Cloudinary.new({ cloud_name: "YOUR_CLOUD_NAME" });

        function validateUpload() {
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];

            if (!file) {
                alert("Please select a file to upload.");
                return;
            }

            // Get transformation options
            const width = document.getElementById("width").value;
            const height = document.getElementById("height").value;
            const quality = document.getElementById("quality").value;
            const format = document.getElementById("format").value;
            const resizeMode = document.getElementById("resizeMode").value;
            const background = document.getElementById("background").value.replace("#", "");
            const maintainExif = document.getElementById("maintainExif").value === "true";

            // Upload the file to Cloudinary with transformations
            uploadFileToCloudinary(file, { width, height, quality, format, resizeMode, background, maintainExif });
        }

        function uploadFileToCloudinary(file, options) {
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", "YOUR_UPLOAD_PRESET"); // Replace with your upload preset
            formData.append("api_key", "YOUR_API_KEY"); // Replace with your API key

            // Add transformations
            const transformations = [];
            if (options.width && options.height) {
                transformations.push(`w_${options.width},h_${options.height},c_${options.resizeMode}`);
            }
            if (options.quality) {
                transformations.push(`q_${options.quality}`);
            }
            if (options.format) {
                transformations.push(`f_${options.format}`);
            }
            if (options.background) {
                transformations.push(`b_${options.background}`);
            }
            if (!options.maintainExif) {
                transformations.push("fl_strip_profile"); // Remove EXIF metadata
            }

            const cloudinaryUrl = `https://api.cloudinary.com/v1_1/${cloudinary.config().cloud_name}/image/upload`;
            if (transformations.length > 0) {
                formData.append("transformation", transformations.join("/"));
            }

            fetch(cloudinaryUrl, {
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                console.log("Uploaded image URL:", data.secure_url);
                addToUploadHistory(data.secure_url, file.name);

                // Show toast notification
                const uploadToast = new mdb.Toast(document.getElementById('uploadToast'));
                uploadToast.show();
            })
            .catch(error => {
                console.error("Upload failed:", error);
                alert("Upload failed. Please try again.");
            });
        }

        function addToUploadHistory(imageUrl, fileName) {
            const uploadHistory = document.getElementById("uploadHistory");
            const timestamp = new Date().toLocaleString();

            const historyItem = document.createElement("div");
            historyItem.classList.add("history-item");
            historyItem.innerHTML = `
                <strong>${fileName}</strong>
                <small class="text-muted">${timestamp}</small>
                <a href="${imageUrl}" download="${fileName}" class="btn btn-success btn-sm mt-2">Download</a>
            `;

            uploadHistory.prepend(historyItem); // Add the new item at the top
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>